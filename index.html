<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Civic Connect - Report & Track Neighborhood Issues</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root {
            --primary-color: #0A2463;
            --primary-light: #1E3A8A;
            --primary-dark: #061A40;
            --text-color: #333;
            --light-bg: #f8f9fa;
            --border-color: #e0e0e0;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: white;
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
        }

        .logo i {
            margin-right: 10px;
        }

        nav ul {
            display: flex;
            list-style: none;
        }

        nav ul li {
            margin-left: 20px;
        }

        nav ul li a {
            color: white;
            text-decoration: none;
            transition: opacity 0.3s;
        }

        nav ul li a:hover {
            opacity: 0.8;
        }

        /* Hero Section */
        .hero {
            background-color: var(--primary-light);
            color: white;
            padding: 3rem 0;
            text-align: center;
        }

        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .hero p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Dashboard Stats */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 2rem 0;
        }

        .stat-card {
            background-color: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            border-left: 4px solid var(--primary-color);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }

        .stat-card p {
            color: #666;
        }

        /* Button Styles */
        .btn {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 0.7rem 1.5rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            text-decoration: none;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background-color: var(--primary-dark);
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
        }

        .btn-outline:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-danger {
            background-color: var(--danger-color);
            border-color: var(--danger-color);
        }

        .btn-danger:hover {
            background-color: #c82333;
            border-color: #bd2130;
        }

        .btn-danger-outline {
            background-color: transparent;
            border: 1px solid var(--danger-color);
            color: var(--danger-color);
        }

        .btn-danger-outline:hover {
            background-color: var(--danger-color);
            color: white;
        }

        /* Form Styles */
        .form-container {
            background-color: white;
            border-radius: 8px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 1rem;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(10, 36, 99, 0.2);
        }

        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }

        /* Loading indicator */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Tabs */
        .tabs {
            display: flex;
            margin: 2rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .tab {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Issues List */
        .issues-container {
            margin: 2rem 0;
        }

        .filter-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 1.5rem;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            background-color: white;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .issues-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .issue-card {
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s;
        }

        .issue-card:hover {
            transform: translateY(-5px);
        }

        .issue-card-header {
            padding: 1rem;
            background-color: var(--light-bg);
            border-bottom: 1px solid var(--border-color);
        }

        .issue-card-body {
            padding: 1rem;
        }

        .issue-card-footer {
            padding: 1rem;
            background-color: var(--light-bg);
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-reported {
            background-color: rgba(220, 53, 69, 0.1);
            color: var(--danger-color);
        }

        .status-in-progress {
            background-color: rgba(255, 193, 7, 0.1);
            color: var(--warning-color);
        }

        .status-resolved {
            background-color: rgba(40, 167, 69, 0.1);
            color: var(--success-color);
        }

        /* Map View */
        .map-container {
            height: 500px;
            background-color: var(--light-bg);
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            margin: 2rem 0;
        }

        #map {
            height: 100%;
            width: 100%;
        }

        .map-placeholder {
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            color: #666;
        }

        .map-placeholder i {
            font-size: 4rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        /* Map Controls */
        .map-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .map-control-btn {
            background-color: white;
            border: none;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .map-control-btn:hover {
            background-color: var(--light-bg);
        }

        .map-control-btn i {
            color: var(--primary-color);
            font-size: 18px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            border-radius: 8px;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        /* Confirmation Modal */
        .confirm-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .confirm-modal-content {
            background-color: white;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            padding: 2rem;
            text-align: center;
        }

        .confirm-modal h3 {
            margin-bottom: 1rem;
            color: var(--danger-color);
        }

        .confirm-modal p {
            margin-bottom: 2rem;
            color: #666;
        }

        .confirm-modal-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            background-color: white;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border-left: 4px solid var(--success-color);
            transform: translateX(150%);
            transition: transform 0.3s ease-out;
            z-index: 1001;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            border-left-color: var(--danger-color);
        }

        .notification.success {
            border-left-color: var(--success-color);
        }

        .notification.info {
            border-left-color: var(--primary-color);
        }

        /* Footer */
        footer {
            background-color: var(--primary-color);
            color: white;
            padding: 2rem 0;
            margin-top: 3rem;
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }

        .footer-section {
            flex: 1;
            min-width: 250px;
            margin-bottom: 1rem;
        }

        .footer-section h3 {
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }

        .footer-section ul {
            list-style: none;
        }

        .footer-section ul li {
            margin-bottom: 0.5rem;
        }

        .footer-section ul li a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-section ul li a:hover {
            color: white;
        }

        .copyright {
            text-align: center;
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #666;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
            opacity: 0.5;
        }

        /* Auth Pages */
        .auth-page {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--primary-color);
            color: white;
        }

        .auth-container {
            max-width: 400px;
            width: 100%;
            background-color: white;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .auth-form h2 {
            text-align: center;
            margin-bottom: 1.5rem;
            color: var(--primary-color);
        }

        .auth-form .form-group label {
            color: var(--text-color);
        }

        .auth-form .form-control {
            color: var(--text-color);
        }

        .auth-links {
            text-align: center;
            margin-top: 1rem;
        }

        .auth-links a {
            display: block;
            margin: 0.5rem 0;
            color: var(--primary-color);
            text-decoration: none;
        }

        .auth-links a:hover {
            text-decoration: underline;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-color);
        }

        .google-btn {
            background-color: #4285f4;
            border: none;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .google-btn:hover {
            background-color: #3367d6;
        }

        .google-btn i {
            font-size: 1.1rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .hidden {
            display: none !important;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
            }

            nav ul {
                margin-top: 1rem;
            }

            .hero h1 {
                font-size: 2rem;
            }

            .tabs {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .issues-list {
                grid-template-columns: 1fr;
            }

            .modal-footer {
                flex-direction: column;
            }

            .modal-footer button {
                width: 100%;
            }

            .auth-container {
                margin: 1rem;
                padding: 1.5rem;
            }

            .user-info {
                margin-top: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-content">
            <div class="logo">
                <i class="fas fa-city"></i>
                Civic Connect
            </div>
            <nav>
                <ul>
                    <li><a href="#" onclick="showSection('dashboard')">Dashboard</a></li>
                    <li><a href="#" onclick="showSection('report')">Report Issue</a></li>
                    <li><a href="#" onclick="showSection('issues')">View Issues</a></li>
                    <li><a href="#" onclick="showSection('map')">Map View</a></li>
                </ul>
            </nav>
            <div id="signedInUser" class="user-info hidden">
                <div class="user-avatar" id="userAvatar"></div>
                <span id="userName"></span>
                <button class="btn-outline" onclick="signOut()">Sign Out</button>
            </div>
            <div id="notSignedIn" class="user-info">
                <button class="btn-outline" onclick="goToSignIn()">Sign In</button>
            </div>
        </div>
    </header>

    <!-- Sign In Page -->
    <div id="signInPage" class="auth-page">
        <div class="container">
            <div class="auth-container">
                <div class="auth-form">
                    <h2>Sign In to Civic Connect</h2>
                    <form id="signInForm">
                        <div class="form-group">
                            <label for="signInEmail">Email</label>
                            <input type="email" id="signInEmail" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="signInPassword">Password</label>
                            <input type="password" id="signInPassword" class="form-control" required>
                        </div>
                        <button type="submit" class="btn">Sign In</button>
                        <div style="text-align: center; margin: 1rem 0;">
                            <span style="color: var(--text-color);">or</span>
                        </div>
                        <button type="button" class="btn google-btn" onclick="signInWithGoogle()">
                            <svg width="18" height="18" viewBox="0 0 24 24">
                                <path fill="#ffffff" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                <path fill="#ffffff" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                <path fill="#ffffff" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                <path fill="#ffffff" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                            </svg>
                            Sign In with Google
                        </button>
                    </form>
                    <div class="auth-links">
                        <a href="#" onclick="showForgotPassword()">Forgot Password?</a>
                        <a href="#" onclick="goToSignUp()">Don't have an account? Sign Up</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sign Up Page -->
    <div id="signUpPage" class="auth-page hidden">
        <div class="container">
            <div class="auth-container">
                <div class="auth-form">
                    <h2>Create Account</h2>
                    <form id="signUpForm">
                        <div class="form-group">
                            <label for="signUpName">Full Name</label>
                            <input type="text" id="signUpName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="signUpEmail">Email</label>
                            <input type="email" id="signUpEmail" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="signUpPassword">Password</label>
                            <input type="password" id="signUpPassword" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="signUpConfirmPassword">Confirm Password</label>
                            <input type="password" id="signUpConfirmPassword" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="agreeTerms" required>
                                I agree to the <a href="#" target="_blank">Terms and Conditions</a>
                            </label>
                        </div>
                        <button type="submit" class="btn">Create Account</button>
                    </form>
                    <div class="auth-links">
                        <a href="#" onclick="goToSignIn()">Already have an account? Sign In</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Forgot Password Page -->
    <div id="forgotPasswordPage" class="auth-page hidden">
        <div class="container">
            <div class="auth-container">
                <div class="auth-form">
                    <h2>Reset Password</h2>
                    <form id="forgotPasswordForm">
                        <div class="form-group">
                            <label for="forgotPasswordEmail">Email</label>
                            <input type="email" id="forgotPasswordEmail" class="form-control" required>
                        </div>
                        <button type="submit" class="btn">Send Reset Link</button>
                    </form>
                    <div class="auth-links">
                        <a href="#" onclick="goToSignIn()">Back to Sign In</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden">
        <!-- Hero Section -->
        <section class="hero">
            <div class="container">
                <h1>Report & Track Neighborhood Issues</h1>
                <p>Help improve your community by reporting civic issues and tracking their resolution</p>
            </div>
        </section>

    <!-- Main Content -->
    <main class="container">
        <!-- Dashboard Section -->
        <section id="dashboard" class="content-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin: 2rem 0 1rem;">
                <h2>Community Dashboard</h2>
                <button class="btn-danger-outline" onclick="signOut()" style="font-size: 0.9rem; padding: 0.5rem 1rem;">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
            
            <div class="stats-container">
                <div class="stat-card">
                    <h3 id="total-issues">0</h3>
                    <p>Total Issues Reported</p>
                </div>
                <div class="stat-card">
                    <h3 id="in-progress-issues">0</h3>
                    <p>In Progress</p>
                </div>
                <div class="stat-card">
                    <h3 id="resolved-issues">0</h3>
                    <p>Resolved Issues</p>
                </div>
                <div class="stat-card">
                    <h3 id="avg-resolution-time">0</h3>
                    <p>Avg. Resolution (Days)</p>
                </div>
            </div>

            <h3 style="margin: 2rem 0 1rem;">Recent Activity</h3>
            <div id="recent-activity" class="issues-list">
                <div class="empty-state">
                    <i class="fas fa-clipboard-list"></i>
                    <p>No issues reported yet</p>
                    <button class="btn" onclick="showSection('report')" style="margin-top: 1rem;">Report Your First Issue</button>
                </div>
            </div>
        </section>

        <!-- Report Issue Section -->
        <section id="report" class="content-section" style="display: none;">
            <h2 style="margin: 2rem 0 1rem;">Report a New Issue</h2>
            
            <div class="form-container">
                <form id="issue-form">
                    <div class="form-group">
                        <label for="issue-title">Issue Title</label>
                        <input type="text" id="issue-title" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="issue-category">Category</label>
                        <select id="issue-category" class="form-control" required>
                            <option value="">Select a category</option>
                            <option value="pothole">Pothole</option>
                            <option value="streetlight">Streetlight</option>
                            <option value="graffiti">Graffiti</option>
                            <option value="waste">Waste Management</option>
                            <option value="park">Park Maintenance</option>
                            <option value="traffic">Traffic Issue</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="issue-location">Location</label>
                        <input type="text" id="issue-location" class="form-control" placeholder="Enter address or location" required>
                        <button type="button" class="btn-outline" style="margin-top: 10px;" onclick="getCurrentLocation()">
                            <i class="fas fa-location-arrow"></i> Use Current Location
                        </button>
                    </div>
                    
                    <div class="form-group">
                        <label for="issue-description">Description</label>
                        <textarea id="issue-description" class="form-control" placeholder="Provide details about the issue" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="issue-image">Upload Image (Optional)</label>
                        <input type="file" id="issue-image" class="form-control" accept="image/*">
                    </div>
                    
                    <div class="form-group">
                        <label for="reporter-name">Your Name</label>
                        <input type="text" id="reporter-name" class="form-control" value="" readonly>
                    </div>

                    <div class="form-group">
                        <label for="reporter-email">Your Email</label>
                        <input type="email" id="reporter-email" class="form-control" value="" readonly>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button type="submit" class="btn" id="submit-btn">Submit Report</button>
                        <button type="button" class="btn-outline" onclick="resetForm()">Reset Form</button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Issues Section -->
        <section id="issues" class="content-section" style="display: none;">
            <h2 style="margin: 2rem 0 1rem;">Community Issues</h2>
            
            <div class="tabs">
                <div class="tab active" onclick="showTab('all-issues')">All Issues</div>
                <div class="tab" onclick="showTab('reported-issues')">Reported</div>
                <div class="tab" onclick="showTab('in-progress-issues')">In Progress</div>
                <div class="tab" onclick="showTab('resolved-issues')">Resolved</div>
            </div>
            
            <div class="filter-container">
                <button class="filter-btn active" onclick="filterIssues('all')">All</button>
                <button class="filter-btn" onclick="filterIssues('pothole')">Pothole</button>
                <button class="filter-btn" onclick="filterIssues('streetlight')">Streetlight</button>
                <button class="filter-btn" onclick="filterIssues('graffiti')">Graffiti</button>
                <button class="filter-btn" onclick="filterIssues('waste')">Waste</button>
                <button class="filter-btn" onclick="filterIssues('park')">Park</button>
                <button class="filter-btn" onclick="filterIssues('traffic')">Traffic</button>
                <button class="filter-btn" onclick="filterIssues('other')">Other</button>
            </div>
            
            <div id="all-issues" class="tab-content active">
                <div class="issues-list" id="issues-list">
                    <div class="empty-state">
                        <i class="fas fa-clipboard-list"></i>
                        <p>No issues reported yet</p>
                        <button class="btn" onclick="showSection('report')" style="margin-top: 1rem;">Report Your First Issue</button>
                    </div>
                </div>
            </div>
            
            <div id="reported-issues" class="tab-content">
                <div class="issues-list" id="reported-issues-list">
                    <div class="empty-state">
                        <i class="fas fa-exclamation-circle"></i>
                        <p>No reported issues</p>
                    </div>
                </div>
            </div>
            
            <div id="in-progress-issues" class="tab-content">
                <div class="issues-list" id="in-progress-issues-list">
                    <div class="empty-state">
                        <i class="fas fa-spinner"></i>
                        <p>No issues in progress</p>
                    </div>
                </div>
            </div>
            
            <div id="resolved-issues" class="tab-content">
                <div class="issues-list" id="resolved-issues-list">
                    <div class="empty-state">
                        <i class="fas fa-check-circle"></i>
                        <p>No resolved issues</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Map Section -->
        <section id="map" class="content-section" style="display: none;">
            <h2 style="margin: 2rem 0 1rem;">Issue Map</h2>
            
            <div class="map-container">
                <div id="map"></div>
                <div class="map-placeholder">
                    <i class="fas fa-map-marked-alt"></i>
                    <h3>Interactive Map View</h3>
                    <p>Map showing all reported issues in your neighborhood</p>
                </div>
                <div class="map-controls">
                    <button class="map-control-btn" id="locate-btn" title="Find My Location">
                        <i class="fas fa-location-arrow"></i>
                    </button>
                </div>
            </div>
            
            <div class="form-container">
                <h3>Map Legend</h3>
                <div style="display: flex; flex-wrap: wrap; gap: 15px; margin-top: 1rem;">
                    <div style="display: flex; align-items: center;">
                        <div style="width: 15px; height: 15px; background-color: var(--danger-color); border-radius: 50%; margin-right: 8px;"></div>
                        <span>Reported</span>
                    </div>
                    <div style="display: flex; align-items: center;">
                        <div style="width: 15px; height: 15px; background-color: var(--warning-color); border-radius: 50%; margin-right: 8px;"></div>
                        <span>In Progress</span>
                    </div>
                    <div style="display: flex; align-items: center;">
                        <div style="width: 15px; height: 15px; background-color: var(--success-color); border-radius: 50%; margin-right: 8px;"></div>
                        <span>Resolved</span>
                    </div>
                    <div style="display: flex; align-items: center;">
                        <div style="width: 15px; height: 15px; background-color: #3388ff; border-radius: 50%; margin-right: 8px;"></div>
                        <span>Your Location</span>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Issue Detail Modal -->
    <div id="issue-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Issue Details</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Issue details will be populated here -->
            </div>
            <div class="modal-footer">
                <button class="btn-danger-outline" onclick="showCancelConfirmation()">Cancel Issue</button>
                <button class="btn" id="update-status-btn" onclick="updateIssueStatus()">Update Status</button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="confirm-modal">
        <div class="confirm-modal-content">
            <h3>Confirm Cancellation</h3>
            <p>Are you sure you want to cancel and delete this issue? This action cannot be undone.</p>
            <div class="confirm-modal-buttons">
                <button class="btn-outline" onclick="hideCancelConfirmation()">No, Keep Issue</button>
                <button class="btn-danger" onclick="confirmCancelIssue()">Yes, Cancel Issue</button>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification">
        <p id="notification-message"></p>
    </div>

        <!-- Footer -->
        <footer>
            <div class="container">
                <div class="footer-content">
                    <div class="footer-section">
                        <h3>About Civic Connect</h3>
                        <p>A platform for citizens to report and track civic issues in their neighborhood, helping build better communities together.</p>
                    </div>
                    <div class="footer-section">
                        <h3>Quick Links</h3>
                        <ul>
                            <li><a href="#" onclick="showSection('dashboard')">Dashboard</a></li>
                            <li><a href="#" onclick="showSection('report')">Report Issue</a></li>
                            <li><a href="#" onclick="showSection('issues')">View Issues</a></li>
                            <li><a href="#" onclick="showSection('map')">Map View</a></li>
                        </ul>
                    </div>
                    <div class="footer-section">
                        <h3>Contact Us</h3>
                        <ul>
                            <li><i class="fas fa-envelope"></i> contact@civicconnect.org</li>
                            <li><i class="fas fa-phone"></i> (123) 456-7890</li>
                            <li><i class="fas fa-map-marker-alt"></i> 123 Main St, City, Country</li>
                        </ul>
                    </div>
                </div>
                <div class="copyright">
                    <p>&copy; 2023 Civic Connect. All rights reserved.</p>
                </div>
            </div>
        </footer>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- Login JS -->
    <script src="login.js"></script>
    
    <script>
        // Initialize data
        let issues = [];
        let currentFilter = 'all';
        let currentIssueId = null;
        let map = null;
        let markers = [];
        let userLocationMarker = null;

        // DOM elements
        const issueForm = document.getElementById('issue-form');
        const issuesList = document.getElementById('issues-list');
        const reportedIssuesList = document.getElementById('reported-issues-list');
        const inProgressIssuesList = document.getElementById('in-progress-issues-list');
        const resolvedIssuesList = document.getElementById('resolved-issues-list');
        const recentActivityList = document.getElementById('recent-activity');
        const notification = document.getElementById('notification');
        const notificationMessage = document.getElementById('notification-message');
        const modal = document.getElementById('issue-modal');
        const confirmModal = document.getElementById('confirm-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalBody = document.getElementById('modal-body');
        const updateStatusBtn = document.getElementById('update-status-btn');
        const submitBtn = document.getElementById('submit-btn');
        const locateBtn = document.getElementById('locate-btn');
        const issueLocationInput = document.getElementById('issue-location');

        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            // Clear any existing data from localStorage
            localStorage.removeItem('civicIssues');

            // Reset dashboard stats
            document.getElementById('total-issues').textContent = '0';
            document.getElementById('in-progress-issues').textContent = '0';
            document.getElementById('resolved-issues').textContent = '0';
            document.getElementById('avg-resolution-time').textContent = '0';

            renderIssues();
            renderRecentActivity();

            // Initialize Firebase auth state listener
            checkSignInStatus();

            // Populate user info in issue form when signed in
            auth.onAuthStateChanged(user => {
                if (user) {
                    document.getElementById('reporter-name').value = user.displayName || user.email.split('@')[0];
                    document.getElementById('reporter-email').value = user.email;
                }
            });
        });

        // Get current location using browser's Geolocation API
        function getCurrentLocation() {
            if (!navigator.geolocation) {
                showNotification('Geolocation is not supported by your browser', true);
                return;
            }

            // Show loading state
            locateBtn.innerHTML = '<span class="loading"></span>';
            locateBtn.disabled = true;

            navigator.geolocation.getCurrentPosition(
                // Success callback
                async (position) => {
                    const { latitude, longitude } = position.coords;
                    
                    // Reverse geocoding to get address from coordinates
                    try {
                        const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}`);
                        const data = await response.json();
                        
                        if (data && data.display_name) {
                            // Update the location input field with the address
                            issueLocationInput.value = data.display_name;
                            showNotification('Current location detected successfully!');
                        } else {
                            // If reverse geocoding fails, use coordinates
                            issueLocationInput.value = `${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;
                            showNotification('Current coordinates detected!');
                        }
                    } catch (error) {
                        console.error('Reverse geocoding error:', error);
                        // If reverse geocoding fails, use coordinates
                        issueLocationInput.value = `${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;
                        showNotification('Current coordinates detected!');
                    }
                    
                    // Reset button state
                    locateBtn.innerHTML = '<i class="fas fa-location-arrow"></i>';
                    locateBtn.disabled = false;
                },
                // Error callback
                (error) => {
                    let errorMessage = 'Failed to get your location: ';
                    
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage += 'Location access denied by user.';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage += 'Location information is unavailable.';
                            break;
                        case error.TIMEOUT:
                            errorMessage += 'Location request timed out.';
                            break;
                        case error.UNKNOWN_ERROR:
                            errorMessage += 'An unknown error occurred.';
                            break;
                    }
                    
                    showNotification(errorMessage, true);
                    
                    // Reset button state
                    locateBtn.innerHTML = '<i class="fas fa-location-arrow"></i>';
                    locateBtn.disabled = false;
                },
                // Options
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 60000
                }
            );
        }

        // Geocode location using OpenStreetMap Nominatim API
        async function geocodeLocation(location) {
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(location)}&limit=1`);
                const data = await response.json();
                
                if (data && data.length > 0) {
                    return {
                        lat: parseFloat(data[0].lat),
                        lng: parseFloat(data[0].lon)
                    };
                }
                return null;
            } catch (error) {
                console.error('Geocoding error:', error);
                return null;
            }
        }

        // Form submission
        issueForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            // Check if user is signed in
            if (!auth.currentUser) {
                showNotification('Please sign in to report an issue', 'error');
                return;
            }

            // Show loading state
            submitBtn.innerHTML = '<span class="loading"></span> Submitting...';
            submitBtn.disabled = true;

            const title = document.getElementById('issue-title').value;
            const category = document.getElementById('issue-category').value;
            const location = document.getElementById('issue-location').value;
            const description = document.getElementById('issue-description').value;
            const reporterName = document.getElementById('reporter-name').value;
            const reporterEmail = document.getElementById('reporter-email').value;

            // Geocode the location
            const coordinates = await geocodeLocation(location);

            const newIssue = {
                id: Date.now(),
                userId: auth.currentUser.uid,
                title,
                category,
                location,
                description,
                reporterName,
                reporterEmail,
                status: 'reported',
                dateReported: new Date().toISOString(),
                dateUpdated: new Date().toISOString(),
                dateResolved: null,
                coordinates: coordinates,
                updates: [{
                    message: 'Issue reported',
                    date: new Date().toISOString(),
                    user: reporterName
                }]
            };

            try {
                // Save to Firebase
                await db.collection('issues').add(newIssue);

                // Add to local array
                issues.push(newIssue);
                saveIssues();

                // Reset form
                issueForm.reset();

                // Show notification
                showNotification('Issue reported successfully!', 'success');

                // Update UI
                updateDashboardStats();
                renderIssues();
                renderRecentActivity();

                // Update map if it's initialized
                if (map) {
                    updateMapMarkers();
                }

                // Switch to issues view
                showSection('issues');
            } catch (error) {
                console.error('Error saving issue:', error);
                showNotification('Error reporting issue: ' + error.message, 'error');
            } finally {
                // Reset button state
                submitBtn.innerHTML = 'Submit Report';
                submitBtn.disabled = false;
            }
        });

        // Reset form
        function resetForm() {
            if (confirm('Are you sure you want to reset the form? All entered data will be lost.')) {
                issueForm.reset();
                showNotification('Form has been reset');
            }
        }

        // Navigation
        function showSection(sectionId) {
            // Hide all sections
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => {
                section.style.display = 'none';
            });
            
            // Show selected section
            document.getElementById(sectionId).style.display = 'block';
            
            // Update active tab in navigation
            const navLinks = document.querySelectorAll('nav ul li a');
            navLinks.forEach(link => {
                link.classList.remove('active');
            });
            
            // Find and activate the corresponding nav link
            const sectionMap = {
                'dashboard': 0,
                'report': 1,
                'issues': 2,
                'map': 3
            };
            
            if (sectionMap[sectionId] !== undefined) {
                navLinks[sectionMap[sectionId]].classList.add('active');
            }
            
            // Initialize map when map section is shown
            if (sectionId === 'map' && !map) {
                setTimeout(() => {
                    initializeMap();
                }, 100);
            }
        }

        // Initialize map
        function initializeMap() {
            // Create map centered on a default location
            map = L.map('map').setView([40.7128, -74.0060], 13); // Default to New York
            
            // Add OpenStreetMap tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
            
            // Add locate button functionality
            locateBtn.addEventListener('click', locateUser);
            
            // Update markers
            updateMapMarkers();
        }

        // Locate user on map
        function locateUser() {
            if (!navigator.geolocation) {
                showNotification('Geolocation is not supported by your browser', true);
                return;
            }

            // Show loading state
            locateBtn.innerHTML = '<span class="loading"></span>';
            locateBtn.disabled = true;

            navigator.geolocation.getCurrentPosition(
                // Success callback
                (position) => {
                    const { latitude, longitude } = position.coords;
                    const userLatLng = [latitude, longitude];
                    
                    // Remove existing user location marker if any
                    if (userLocationMarker) {
                        map.removeLayer(userLocationMarker);
                    }
                    
                    // Add user location marker
                    userLocationMarker = L.marker(userLatLng, {
                        icon: L.divIcon({
                            className: 'user-location-marker',
                            html: '<div style="background-color: #3388ff; width: 20px; height: 20px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.3);"></div>',
                            iconSize: [20, 20],
                            iconAnchor: [10, 10]
                        })
                    }).addTo(map);
                    
                    // Add popup to user location marker
                    userLocationMarker.bindPopup('<b>Your Current Location</b>').openPopup();
                    
                    // Center map on user location
                    map.setView(userLatLng, 15);
                    
                    showNotification('Your location has been detected on the map!');
                    
                    // Reset button state
                    locateBtn.innerHTML = '<i class="fas fa-location-arrow"></i>';
                    locateBtn.disabled = false;
                },
                // Error callback
                (error) => {
                    let errorMessage = 'Failed to get your location: ';
                    
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage += 'Location access denied by user.';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage += 'Location information is unavailable.';
                            break;
                        case error.TIMEOUT:
                            errorMessage += 'Location request timed out.';
                            break;
                        case error.UNKNOWN_ERROR:
                            errorMessage += 'An unknown error occurred.';
                            break;
                    }
                    
                    showNotification(errorMessage, true);
                    
                    // Reset button state
                    locateBtn.innerHTML = '<i class="fas fa-location-arrow"></i>';
                    locateBtn.disabled = false;
                },
                // Options
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 60000
                }
            );
        }

        // Update map markers
        function updateMapMarkers() {
            // Clear existing markers
            markers.forEach(marker => map.removeLayer(marker));
            markers = [];
            
            // Add markers for each issue with coordinates
            issues.forEach(issue => {
                if (issue.coordinates) {
                    let markerColor;
                    switch (issue.status) {
                        case 'reported':
                            markerColor = '#dc3545';
                            break;
                        case 'in-progress':
                            markerColor = '#ffc107';
                            break;
                        case 'resolved':
                            markerColor = '#28a745';
                            break;
                        default:
                            markerColor = '#0A2463';
                    }
                    
                    const marker = L.circleMarker([issue.coordinates.lat, issue.coordinates.lng], {
                        radius: 8,
                        fillColor: markerColor,
                        color: '#fff',
                        weight: 2,
                        opacity: 1,
                        fillOpacity: 0.8
                    }).addTo(map);
                    
                    // Add popup
                    marker.bindPopup(`
                        <div>
                            <h4>${issue.title}</h4>
                            <p><strong>Status:</strong> ${issue.status.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())}</p>
                            <p><strong>Category:</strong> ${issue.category.charAt(0).toUpperCase() + issue.category.slice(1)}</p>
                            <p><strong>Location:</strong> ${issue.location}</p>
                            <button class="btn" style="margin-top: 10px; font-size: 12px; padding: 5px 10px;" onclick="viewIssueDetails(${issue.id})">View Details</button>
                        </div>
                    `);
                    
                    markers.push(marker);
                }
            });
            
            // Fit map to show all markers if there are any
            if (markers.length > 0) {
                const group = new L.featureGroup(markers);
                map.fitBounds(group.getBounds().pad(0.1));
            }
        }

        // Tab functionality
        function showTab(tabId) {
            // Update active tab
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Show selected tab content
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabId).classList.add('active');
        }

        // Filter issues
        function filterIssues(filter) {
            currentFilter = filter;
            
            // Update active filter button
            const filterBtns = document.querySelectorAll('.filter-btn');
            filterBtns.forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Re-render issues
            renderIssues();
        }

        // Render issues
        function renderIssues() {
            renderIssuesList(issuesList, 'all');
            renderIssuesList(reportedIssuesList, 'reported');
            renderIssuesList(inProgressIssuesList, 'in-progress');
            renderIssuesList(resolvedIssuesList, 'resolved');
        }

        function renderIssuesList(container, statusFilter) {
            container.innerHTML = '';
            
            let filteredIssues = issues;
            
            // Apply status filter if not 'all'
            if (statusFilter !== 'all') {
                filteredIssues = issues.filter(issue => issue.status === statusFilter);
            }
            
            // Apply category filter
            if (currentFilter !== 'all') {
                filteredIssues = filteredIssues.filter(issue => issue.category === currentFilter);
            }
            
            // Sort by date reported (newest first)
            filteredIssues.sort((a, b) => new Date(b.dateReported) - new Date(a.dateReported));
            
            if (filteredIssues.length === 0) {
                // Show appropriate empty state based on filter
                let emptyMessage = 'No issues found';
                let emptyIcon = 'fas fa-clipboard-list';
                let showButton = false;
                
                if (statusFilter === 'reported') {
                    emptyMessage = 'No reported issues';
                    emptyIcon = 'fas fa-exclamation-circle';
                } else if (statusFilter === 'in-progress') {
                    emptyMessage = 'No issues in progress';
                    emptyIcon = 'fas fa-spinner';
                } else if (statusFilter === 'resolved') {
                    emptyMessage = 'No resolved issues';
                    emptyIcon = 'fas fa-check-circle';
                } else if (issues.length === 0) {
                    emptyMessage = 'No issues reported yet';
                    showButton = true;
                }
                
                const emptyState = document.createElement('div');
                emptyState.className = 'empty-state';
                emptyState.innerHTML = `
                    <i class="${emptyIcon}"></i>
                    <p>${emptyMessage}</p>
                    ${showButton ? '<button class="btn" onclick="showSection(\'report\')" style="margin-top: 1rem;">Report Your First Issue</button>' : ''}
                `;
                container.appendChild(emptyState);
                return;
            }
            
            filteredIssues.forEach(issue => {
                const issueCard = createIssueCard(issue);
                container.appendChild(issueCard);
            });
        }

        // Create issue card
        function createIssueCard(issue) {
            const card = document.createElement('div');
            card.className = 'issue-card';
            
            const statusClass = `status-${issue.status}`;
            const statusText = issue.status.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());
            
            const formattedDate = new Date(issue.dateReported).toLocaleDateString();
            
            card.innerHTML = `
                <div class="issue-card-header">
                    <h3>${issue.title}</h3>
                    <span class="status-badge ${statusClass}">${statusText}</span>
                </div>
                <div class="issue-card-body">
                    <p><strong>Category:</strong> ${issue.category.charAt(0).toUpperCase() + issue.category.slice(1)}</p>
                    <p><strong>Location:</strong> ${issue.location}</p>
                    <p><strong>Reported:</strong> ${formattedDate}</p>
                </div>
                <div class="issue-card-footer">
                    <button class="btn-outline" onclick="viewIssueDetails(${issue.id})">View Details</button>
                </div>
            `;
            
            return card;
        }

        // View issue details
        function viewIssueDetails(issueId) {
            const issue = issues.find(i => i.id === issueId);
            if (!issue) return;
            
            currentIssueId = issueId;
            
            const statusClass = `status-${issue.status}`;
            const statusText = issue.status.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());
            
            const formattedReportedDate = new Date(issue.dateReported).toLocaleDateString();
            const formattedUpdatedDate = new Date(issue.dateUpdated).toLocaleDateString();
            
            let resolvedDateHtml = '';
            if (issue.dateResolved) {
                const formattedResolvedDate = new Date(issue.dateResolved).toLocaleDateString();
                resolvedDateHtml = `<p><strong>Resolved Date:</strong> ${formattedResolvedDate}</p>`;
            }
            
            // Build updates HTML
            let updatesHtml = '<div style="margin-top: 1.5rem;"><h4>Updates</h4><ul style="padding-left: 20px;">';
            issue.updates.forEach(update => {
                const updateDate = new Date(update.date).toLocaleDateString();
                updatesHtml += `<li><strong>${updateDate}:</strong> ${update.message} - ${update.user}</li>`;
            });
            updatesHtml += '</ul></div>';
            
            modalTitle.textContent = issue.title;
            modalBody.innerHTML = `
                <div style="margin-bottom: 1rem;">
                    <span class="status-badge ${statusClass}">${statusText}</span>
                </div>
                <p><strong>Category:</strong> ${issue.category.charAt(0).toUpperCase() + issue.category.slice(1)}</p>
                <p><strong>Location:</strong> ${issue.location}</p>
                ${issue.coordinates ? `<p><strong>Coordinates:</strong> ${issue.coordinates.lat.toFixed(6)}, ${issue.coordinates.lng.toFixed(6)}</p>` : ''}
                <p><strong>Reported By:</strong> ${issue.reporterName}</p>
                <p><strong>Email:</strong> ${issue.reporterEmail}</p>
                <p><strong>Reported Date:</strong> ${formattedReportedDate}</p>
                <p><strong>Last Updated:</strong> ${formattedUpdatedDate}</p>
                ${resolvedDateHtml}
                <div style="margin-top: 1.5rem;">
                    <h4>Description</h4>
                    <p>${issue.description}</p>
                </div>
                ${updatesHtml}
            `;
            
            // Show/hide update status button based on current status
            if (issue.status === 'resolved') {
                updateStatusBtn.style.display = 'none';
            } else {
                updateStatusBtn.style.display = 'inline-block';
                
                // Update button text based on current status
                if (issue.status === 'reported') {
                    updateStatusBtn.textContent = 'Mark In Progress';
                } else if (issue.status === 'in-progress') {
                    updateStatusBtn.textContent = 'Mark Resolved';
                }
            }
            
            modal.style.display = 'flex';
        }

        // Show cancel confirmation modal
        function showCancelConfirmation() {
            confirmModal.style.display = 'flex';
        }

        // Hide cancel confirmation modal
        function hideCancelConfirmation() {
            confirmModal.style.display = 'none';
        }

        // Confirm cancel issue
        function confirmCancelIssue() {
            // Remove the issue from the array
            issues = issues.filter(issue => issue.id !== currentIssueId);
            saveIssues();
            hideCancelConfirmation();
            closeModal();
            showNotification('Issue has been canceled and deleted');
            
            // Update UI
            updateDashboardStats();
            renderIssues();
            renderRecentActivity();
            
            // Update map if it's initialized
            if (map) {
                updateMapMarkers();
            }
        }

        // Update issue status
        function updateIssueStatus() {
            const issue = issues.find(i => i.id === currentIssueId);
            if (!issue) return;
            
            const previousStatus = issue.status;
            
            if (issue.status === 'reported') {
                issue.status = 'in-progress';
                issue.updates.push({
                    message: 'Status updated to In Progress',
                    date: new Date().toISOString(),
                    user: 'System'
                });
            } else if (issue.status === 'in-progress') {
                issue.status = 'resolved';
                issue.dateResolved = new Date().toISOString();
                issue.updates.push({
                    message: 'Issue has been resolved',
                    date: new Date().toISOString(),
                    user: 'System'
                });
            }
            
            issue.dateUpdated = new Date().toISOString();
            
            saveIssues();
            closeModal();
            showNotification(`Issue status updated from ${previousStatus} to ${issue.status}`);
            
            // Update UI
            updateDashboardStats();
            renderIssues();
            renderRecentActivity();
            
            // Update map if it's initialized
            if (map) {
                updateMapMarkers();
            }
        }

        // Close modal
        function closeModal() {
            modal.style.display = 'none';
            currentIssueId = null;
        }

        // Show notification
        function showNotification(message, isError = false) {
            notificationMessage.textContent = message;
            
            if (isError) {
                notification.classList.add('error');
            } else {
                notification.classList.remove('error');
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Update dashboard stats
        function updateDashboardStats() {
            const totalIssues = issues.length;
            const inProgressIssues = issues.filter(issue => issue.status === 'in-progress').length;
            const resolvedIssues = issues.filter(issue => issue.status === 'resolved').length;
            
            // Calculate average resolution time
            const resolvedIssuesList = issues.filter(issue => issue.status === 'resolved' && issue.dateResolved);
            let totalDays = 0;
            
            resolvedIssuesList.forEach(issue => {
                const reportedDate = new Date(issue.dateReported);
                const resolvedDate = new Date(issue.dateResolved);
                const diffTime = Math.abs(resolvedDate - reportedDate);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                totalDays += diffDays;
            });
            
            const avgResolutionTime = resolvedIssuesList.length > 0 ? 
                Math.round(totalDays / resolvedIssuesList.length) : 0;
            
            document.getElementById('total-issues').textContent = totalIssues;
            document.getElementById('in-progress-issues').textContent = inProgressIssues;
            document.getElementById('resolved-issues').textContent = resolvedIssues;
            document.getElementById('avg-resolution-time').textContent = avgResolutionTime;
        }

        // Render recent activity
        function renderRecentActivity() {
            recentActivityList.innerHTML = '';
            
            // Sort by date reported (newest first) and take first 3
            const recentIssues = [...issues]
                .sort((a, b) => new Date(b.dateReported) - new Date(a.dateReported))
                .slice(0, 3);
            
            if (recentIssues.length === 0) {
                const emptyState = document.createElement('div');
                emptyState.className = 'empty-state';
                emptyState.innerHTML = `
                    <i class="fas fa-clipboard-list"></i>
                    <p>No issues reported yet</p>
                    <button class="btn" onclick="showSection('report')" style="margin-top: 1rem;">Report Your First Issue</button>
                `;
                recentActivityList.appendChild(emptyState);
                return;
            }
            
            recentIssues.forEach(issue => {
                const issueCard = createIssueCard(issue);
                recentActivityList.appendChild(issueCard);
            });
        }

        // Save issues to localStorage
        function saveIssues() {
            localStorage.setItem('civicIssues', JSON.stringify(issues));
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            if (event.target === modal) {
                closeModal();
            }
            if (event.target === confirmModal) {
                hideCancelConfirmation();
            }
        }
    </script>
</body>
</html>
